@page "/registererth"
@inject HttpClient httpClient
@* @inject IHttpClientFactory ClientFactory *@

<h3 class="center">درخواست کد فعالسازی نرم افزار</h3>
<section>
  <p>برای دریافت کد فعالسازی نرم افزار ارث به موارد زیر دقت کنید:</p>
  <ul>
    <li>قویا توصیه می شود که در صورت امکان از روش خودکار برای فعالسازی نرم افزار استفاده کنید</li>
    <li>در انتخاب نسخه نرم افزار(حرفه ای یا علمی کاربردی) دقت کنید</li>
    <li class="text-primary">منظور از برچسب سی دی کدی است که به همراه سی دی نرم افزار ارایه شده است.</li>
    <li class="text-primary">منظور از کد ارایه شده توسط نرم افزار کدی است که هنگام اجرای نرم افزار در برگه روش دستی دیده
      می شود.</li>
    <li class="text-danger">در وارد کردن کد ارایه شده توسط نرم افزار دقت کنید. حتی یک حرف یا عدد اشتباه نشود در غیر
      اینصورت کد فعالسازی اشتباه دریافت خواهید کرد.</li>
    <li class="text-danger">در صورتیکه با گوشی اندرویدی در این سامانه وارد شده اید. 
    دقت کنید که همه اعداد موجود در برچسب سی دی و شماره سریال 
    ارایه شده توسط نرم افزار را صرفا با صفحه کلید انگلیسی و نه فارسی وارد کنید.</li>
  </ul>
</section>

<section>
  <div class="container">
    <div class="row">      
      <div class="col-md-8 mx-auto">
    <div class="border rounded p-3 bg-light">
      <div class="form-group">
        <label for="softwaretype">نسخه نرم افزار:</label>
        <div>
          <select name="softwaretype" id="softwaretype" @bind="registerCd.SoftwareType">
            <option value="" disabled selected>نسخه نرم افزار خود را انتخاب کنید</option>
            <option value="0">حرفه ای- شعب حل اختلاف</option>
            <option value="1">علمی-کاربردی</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="fullname">نام و نام خانوادگی:</label>
        <div>
          <input class="form-control" id="fullname" @bind="registerCd.FullName" placeholder="نام و نام خانوادگی خود را بنویسید" name="fullname">
        </div>
      </div>
      <div class="form-group">
        <label for="ostan">استان:</label>
        <div>
          <select name="ostan" id="ostan" @bind="registerCd.United">
            <option value="" disabled selected>نام استان</option>
            <option value="آذربایجان شرقی">آذربایجان شرقی</option>
            <option value="آذربایجان غربی">آذربایجان غربی</option>
            <option value="اردبیل">اردبیل</option>
            <option value="اصفهان">اصفهان</option>
            <option value="البرز">البرز</option>
            <option value="ایلام">ایلام</option>
            <option value="بوشهر">بوشهر</option>
            <option value="تهران">تهران</option>
            <option value="چهارمحال و بختیاری">چهارمحال و بختیاری</option>
            <option value="خراسان جنوبی">خراسان جنوبی</option>
            <option value="خراسان رضوی">خراسان رضوی</option>
            <option value="خراسان شمالی">خراسان شمالی</option>
            <option value="خوزستان">خوزستان</option>
            <option value="زنجان">زنجان</option>
            <option value="سمنان">سمنان</option>
            <option value="سیستان و بلوچستان">سیستان و بلوچستان</option>
            <option value="فارس">فارس</option>
            <option value="قزوین">قزوین</option>
            <option value="قم">قم</option>
            <option value="کردستان">کردستان</option>
            <option value="کرمان">کرمان</option>
            <option value="کرمانشاه">کرمانشاه</option>
            <option value="کهکیلویه و بویراحمد">کهکیلویه و بویراحمد</option>
            <option value="گلستان">گلستان</option>
            <option value="گیلان">گیلان</option>
            <option value="لرستان">لرستان</option>
            <option value="مازندران">مازندران</option>
            <option value="مرکزی">مرکزی</option>
            <option value="هرمزگان">هرمزگان</option>
            <option value="همدان">همدان</option>
            <option value="یزد">یزد</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="fullname">شهر:</label>
        <div>
          <input class="form-control" id="city" placeholder="نام شهر را وارد کنید" name="city" @bind="registerCd.City">
        </div>
      </div>
      @if (registerCd.SoftwareType == "0") { //Pro
        <div class="form-group">
          <label for="shobeh">شعبه:</label>
          <div>
            <input class="form-control" id="shobeh" placeholder="نام یا شماره شعبه" name="shobeh" @bind="registerCd.Shobeh">
          </div>
        </div>
      }
      <div class="form-group">
        <label for="cdlabel" >برچسب سی دی:</label>
        <div>
          <input style="direction: ltr;" class="form-control" id="cdlabel" placeholder="کدی که به همراه سی دی نرم افزار دریافت کرده اید" name="cdlabel" @bind="registerCd.CdLabel">
        </div>
      </div>
      <div class="form-group">
        <label for="sn">کد ارایه شده توسط نرم افزار:</label>
        <div>
          <input style="direction: ltr;" class="form-control" id="sn" placeholder="کدی که نرم افزار به شما داده است" name="sn" @bind="registerCd.Sn">
        </div>
      </div>
      <div class="form-group">
          <button  class="btn btn-primary btn-block" @onclick="BtnRegister">دریافت کد فعالسازی</button>
      </div>
      @if (string.IsNullOrEmpty(actionResult) == false) {
        <div class="form-group">
          <label class="text-danger">@actionResult</label>
        </div>
      }
    </div>
    </div>
    </div>
  </div>

</section>

@code {
  
  RegisterCdVM registerCd = new RegisterCdVM();
  string actionResult=null;

  public async Task BtnRegister() {    
    foreach (var prp in registerCd.GetType().GetProperties()) {
       Console.WriteLine(prp.GetValue(registerCd));
    }

    if (string.IsNullOrEmpty(registerCd.CdLabel) ||
        string.IsNullOrEmpty(registerCd.City) ||
        string.IsNullOrEmpty(registerCd.FullName) ||
        (string.IsNullOrEmpty(registerCd.Shobeh ) && registerCd.SoftwareType == "pro") ||
        string.IsNullOrEmpty(registerCd.United) ||
        string.IsNullOrEmpty(registerCd.Sn) ||
        string.IsNullOrEmpty(registerCd.SoftwareType)
    )
    {
      Console.WriteLine("خطا! لطفا همه فیلدها را پر کنید");
      actionResult = "خطا! لطفا همه فیلدها را پر کنید";
      return;
    }

    try {

      //var httpClient = ClientFactory.CreateClient("Erth.ServerAPI.NoAuthenticationClient");


      var result = await httpClient.PostAsJsonAsync<RegisterCdVM>("api/RegisterCd", registerCd);
      var resultJson = result.Content.ReadFromJsonAsync<TbActionResult<RegisterCdVM>>();
      Console.WriteLine(resultJson.Result.Desc);
      actionResult = resultJson.Result.Desc;
    }
    catch (Exception err)
    {
        Console.WriteLine("Error:" + err);
    }
  }
}